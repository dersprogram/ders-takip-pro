
<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Haftalık</title>
<style>
  :root{
    --bg0:#060a12;
    --bg1:#0b1220;
    --orange:#ff7a00;
    --grid: rgba(255,255,255,.16);
    --text: rgba(255,255,255,.92);
    --muted: rgba(255,255,255,.70);
    --innerPad: 18px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(900px 520px at 50% -200px, rgba(255,122,0,.14), transparent 60%),
      linear-gradient(180deg, var(--bg0), var(--bg1));
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    padding: 18px 12px;
  }

  .phone{
    max-height: 86vh;
    width: min(900px, 92vw);
    aspect-ratio: 16 / 9;
    border: 3px solid var(--orange);
    border-radius: 26px;
    box-shadow: 0 28px 80px rgba(0,0,0,.55);
    position:relative;
    overflow:hidden;
    padding: var(--innerPad);
  }
  
  /* Gerçek yatayda tablo ekranı daha çok doldursun */
  @media (orientation: landscape){
    .phone{
      width: 96vw;
      aspect-ratio: 16 / 9;
    }
  }


  body.portrait .phone{
    width: min(420px, 94vw);
    aspect-ratio: 9 / 16;
  }

  .topBtns{
    position:absolute;
    left: 22px;
    right: 22px;
    top: 18px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    z-index: 5;
    pointer-events:none;
  }
  .btn{
    pointer-events:auto;
    border: 1px solid rgba(255,255,255,.55);
    background: rgba(255,255,255,.08);
    color: var(--orange);
    font-weight: 900;
    border-radius: 12px;
    padding: 6px 10px;
    font-size: 13px;
    line-height: 1;
    box-shadow: inset 0 0 0 1px rgba(0,0,0,.25);
    user-select:none;
    cursor:pointer;
  }
  .btn:active{ transform: scale(.98); }

  .hint{
    pointer-events:none;
    font-weight: 900;
    font-size: 13px;
    line-height: 1.1;
    color: rgba(255,255,255,.86);
    padding: 6px 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-shadow: 0 1px 0 rgba(0,0,0,.35);
  }


  .frame{
    position:absolute;
    inset: calc(var(--innerPad) + 40px) 6px calc(var(--innerPad) + 40px) 6px;
    border: 3px solid rgba(255,255,255,.95);
    border-radius: 22px;
    overflow:hidden;
  }
  body.portrait .frame{
    inset: calc(var(--innerPad) + 74px) calc(var(--innerPad) + 10px) auto calc(var(--innerPad) + 10px);
    height: 42%;
    min-height: 280px;
    max-height: 420px;
  }

  .grid{
    width:100%;
    height:100%;
    display:grid;
    grid-template-columns: 70px repeat(8, 1fr);
    grid-template-rows: 44px repeat(7, 1fr);
    background: rgba(0,0,0,.14);
  }
  body.portrait .grid{
    grid-template-columns: 52px repeat(8, 1fr);
    grid-template-rows: 40px repeat(7, 1fr);
  }

  .cell{
    border-right: 1px solid var(--grid);
    border-bottom: 1px solid var(--grid);
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    padding: 4px 6px;
    font-weight: 900;
    letter-spacing: .02em;
    font-size: 12.5px;
    line-height: 1.05;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .cell.muted{ color: rgba(255,255,255,.86); }

  .cell.headCell{
    flex-direction: column;
    gap: 2px;
    white-space: normal;
  }
  .time{
    display:block;
    margin-top: 2px;
    font-size: 10px;
    font-weight: 800;
    letter-spacing: .02em;
    color: rgba(255,255,255,.65);
  }

  .demoLesson{
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap: 2px;
    text-align:center;
    line-height:1.05;
    font-weight: 900;
    color: var(--orange);
  }
  .demoCls{ font-size: 11px; }
  .demoLes{ font-size: 11px; font-weight: 800; }
  body.portrait .demoCls, body.portrait .demoLes{ font-size: 10px; }

  body.portrait .time{ font-size: 9px; }

  .cell.small{
    font-size: 11px;
    font-weight: 900;
    color: var(--orange);
  }
  body.portrait .cell.small{ font-size: 10.5px; }

  .cell.dayCol{ border-right: 2px solid rgba(255,255,255,.78); }
  .cell.headRow{ border-bottom: 2px solid rgba(255,255,255,.78); }

  .cell.lastCol{ border-right: none; }
  .cell.lastRow{ border-bottom: none; }

  /* Dikeyde ders no tek satır kalsın */
  body.portrait .cell.headCell{
    white-space: nowrap;
  }


  /* === LANDSCAPE: hide hint, float back button === */
  body:not(.portrait) .hint{
    display: none;
  }
  body:not(.portrait) .topBtns{
    pointer-events:none;
  }
  body:not(.portrait) #backBtn{
    position: fixed;
    top: 18px;
    right: 22px;
    z-index: 20;
    pointer-events:auto;
    background: rgba(0,0,0,.35);
    backdrop-filter: blur(6px);
  }


  /* === LANDSCAPE: frame edges close to orange on ALL sides === */
  body:not(.portrait) .frame{
    inset: 10px 6px 10px 6px !important;
  }

</style>
</head>
<body class="portrait">
  <div class="phone" role="application" aria-label="Haftalık">
    <div class="topBtns">
      <div class="hint">Daha iyi görünüm için telefonu yatay çevirin.</div>
      <button id="backBtn" class="btn" type="button">Geri</button>
    </div>

    <div class="frame">
      <div id="grid" class="grid" aria-label="Haftalık çizelge"></div>
    </div>
  </div>

<script>
const ALL_DAYS = ["Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi","Pazar"];
const LS_SCHEDULE_KEY   = "dt_schedule_v1";
const LS_ACTIVE_DAYS_KEY= "dt_active_days_v1";
const LS_ITEMS_KEY      = "dt_items";
const LS_COURSE_COLORS_KEY = "dt_course_colors_v1";
const LS_TIME_FMT_KEY   = "dt_time_fmt_v1";

function loadJSON(key, fallback){
  try{
    const raw = localStorage.getItem(key);
    if(!raw) return fallback;
    return JSON.parse(raw);
  }catch(e){ return fallback; }
}

function getTimeFmt(){
  const v = localStorage.getItem(LS_TIME_FMT_KEY);
  return (v === "start" || v === "range") ? v : "range";
}

function getActiveDays(){
  const v = loadJSON(LS_ACTIVE_DAYS_KEY, null);
  return (Array.isArray(v) && v.length) ? v : [...ALL_DAYS];
}

function getCourseColor(name){
  const k = String(name||"").trim();
  if(!k) return null;
  const m = loadJSON(LS_COURSE_COLORS_KEY, {});
  return (m && typeof m === "object") ? (m[k] || null) : null;
}

function readSchedule(){
  const sch = loadJSON(LS_SCHEDULE_KEY, null);
  if(sch && typeof sch === "object" && !Array.isArray(sch)){
    const out = {};
    ALL_DAYS.forEach(d=> out[d] = Array.isArray(sch[d]) ? sch[d] : []);
    return out;
  }
  const legacy = loadJSON(LS_ITEMS_KEY, null);
  const out = {};
  ALL_DAYS.forEach(d=>out[d]=[]);
  if(Array.isArray(legacy)){
    legacy.forEach(it=>{
      const d = (it && (it.day || it.d || it.gun)) || "";
      const day = ALL_DAYS.includes(d) ? d : null;
      if(!day) return;
      out[day].push({
        no: it.no ?? it.dersNo ?? it.n,
        cls: it.cls ?? it.c,
        les: it.les ?? it.lesson ?? it.l,
        time: it.time ?? it.t
      });
    });
  }
  return out;
}

function dayShort(day){
  const map = {"Pazartesi":"Pzt","Salı":"Sal","Çarşamba":"Çar","Perşembe":"Per","Cuma":"Cum","Cumartesi":"Cmt","Pazar":"Paz"};
  return map[day] || day;
}
function lessonLabel(i, portrait){
  return portrait ? `${i}. D` : `${i}. Ders`;
}

function abbrSingleWord(w){
  const s = (w||"").trim();
  if(!s) return "";
  if(s.length <= 6) return s;
  return s.slice(0,4) + ".";
}
function abbrLessonName(name, portrait){
  const raw = (name||"").toString().trim();
  if(!raw) return "";
  const parts = raw.split(/\s+/).filter(Boolean);

  if(portrait){
    if(parts.length === 2){
      return (parts[0][0] + parts[1][0]).toUpperCase();
    }
    if(parts.length === 1){
      return abbrSingleWord(parts[0]);
    }
    return (parts[0][0] + parts[1][0]).toUpperCase();
  }else{
    if(parts.length >= 2){
      return (parts[0][0].toUpperCase() + " " + parts[1]);
    }
    return raw;
  }
}

function buildTimeByNo(schedule){
  const times = {};
  for(let i=1;i<=8;i++) times[i] = "";
  for(const day of ALL_DAYS){
    (schedule[day]||[]).forEach(r=>{
      const no = parseInt(r && (r.no ?? r.dersNo ?? r.dersno ?? r.n), 10);
      if(!(no>=1 && no<=8)) return;
      const t = (r.time || "").trim();
      if(!times[no] && t) times[no] = t;
    });
  }
  if(!times[1]) times[1] = (getTimeFmt()==="start") ? "08:15" : "08:15-08:55";
  return times;
}

function renderGrid(){
  const portrait = !window.matchMedia('(orientation: landscape)').matches;
  const grid = document.getElementById('grid');
  grid.innerHTML = "";

  const activeDays = getActiveDays();
  const daysShown = (Array.isArray(activeDays) && activeDays.length)
    ? ALL_DAYS.filter(d => activeDays.includes(d))
    : ALL_DAYS.slice();

  const headH = portrait ? 40 : 44;
  grid.style.gridTemplateRows = `${headH}px repeat(${daysShown.length}, 1fr)`;

  const schedule = readSchedule();
  const timesByNo = buildTimeByNo(schedule);

  const totalRows = 1 + daysShown.length;

  for(let r=0; r<totalRows; r++){
    for(let c=0; c<9; c++){
      const el = document.createElement('div');
      el.className = "cell";

      const isHeadRow = (r===0);
      const isDayCol = (c===0);

      if(isDayCol) el.classList.add('dayCol');
      if(isHeadRow) el.classList.add('headRow');

      if(c===8) el.classList.add('lastCol');
      if(r===totalRows-1) el.classList.add('lastRow');

      if(r===0 && c===0){
        el.textContent = "";
      }else if(r===0 && c>0){
        const i = c;
        el.classList.add('muted','headCell');
        if(portrait){
          el.innerHTML = `<div>${lessonLabel(i, true)}</div>`;
        }else{
          el.innerHTML = `<div>${lessonLabel(i, false)}</div><span class="time">${timesByNo[i] || ""}</span>`;
        }
      }else if(r>0 && c===0){
        const day = daysShown[r-1];
        el.textContent = portrait ? dayShort(day) : day;
        el.classList.add('muted');
      }else{
        el.innerHTML = `<div class="demoLesson"><div class="demoCls">22/A</div><div class="demoLes">Kelam</div></div>`;
      }

      grid.appendChild(el);
    }
  }
}

const toggleBtn = document.getElementById('toggleBtn');
const backBtn = document.getElementById('backBtn');

function syncRealOrientation(){
  const isLand = window.matchMedia('(orientation: landscape)').matches;
  document.body.classList.toggle('portrait', !isLand);
}
window.addEventListener('orientationchange', ()=>{ syncRealOrientation(); renderGrid(); });
window.addEventListener('resize', ()=>{ syncRealOrientation(); renderGrid(); });


function syncToggleText(){
  // toggleBtn kaldırıldı; burada sadece uyumluluk için bırakıldı
  return;
}
// toggleBtn kaldırıldı (hint yazısı var)


backBtn.addEventListener('click', ()=>{
  if(history.length > 1) history.back();
  else window.location.href = "anasayfa.html";
});

syncRealOrientation();
renderGrid();
</script>
</body>
</html>
